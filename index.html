<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0066cc">
    <meta name="description" content="Librus Synergia Login">
    
    <!-- PWA манифест -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Иконки для PWA -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <!-- Предотвращение кэширования -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Librus Synergia</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        
        #librus-container {
            width: 100%;
            height: 100vh;
            border: none;
            overflow: hidden;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Spinner для загрузки */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .loader.active {
            display: block;
        }
        
        /* Стили для оффлайн-сообщения */
        .offline-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f44336;
            color: white;
            text-align: center;
            padding: 1em;
            z-index: 1000;
        }
        
        .offline .offline-message {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Оффлайн сообщение -->
    <div class="offline-message">
        Brak połączenia z internetem
    </div>
    
    <!-- Контейнер для iframe -->
    <div id="librus-container">
        <iframe 
            src="https://portal.librus.pl/rodzina/synergia/loguj" 
            title="Librus Synergia Login"
            sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
            loading="eager">
        </iframe>
    </div>
    
    <!-- Спиннер загрузки -->
    <div class="loader">
        <svg width="50" height="50" viewBox="0 0 50 50">
            <circle cx="25" cy="25" r="20" fill="none" stroke="#0066cc" stroke-width="5">
                <animate attributeName="stroke-dasharray" dur="1.5s" repeatCount="indefinite"
                    values="1,150;90,150;90,150"/>
                <animate attributeName="stroke-dashoffset" dur="1.5s" repeatCount="indefinite"
                    values="0;-35;-124"/>
            </circle>
        </svg>
    </div>

    <script>
        // Регистрация Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Обработка состояния оффлайн/онлайн
        window.addEventListener('online', function() {
            document.body.classList.remove('offline');
        });

        window.addEventListener('offline', function() {
            document.body.classList.add('offline');
        });

        // Обработка загрузки iframe
        const iframe = document.querySelector('iframe');
        const loader = document.querySelector('.loader');

        iframe.addEventListener('load', function() {
            loader.classList.remove('active');
        });

        loader.classList.add('active');

        // Обработка ошибок загрузки iframe
        iframe.addEventListener('error', function() {
            loader.classList.remove('active');
            alert('Nie można załadować strony Librus. Sprawdź połączenie z internetem.');
        });

        // Предотвращение масштабирования на мобильных устройствах
        document.addEventListener('touchmove', function(event) {
            if (event.scale !== 1) {
                event.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>